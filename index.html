<script>
  // -----------------------------
  // Text packs (EN / zh-Hans / zh-Hant)
  // -----------------------------
  const I18N = {
    en: {
      locale: "Locale",
      about: "About Us",
      products: "Products",
      services: "Services",
      home: "Home",
      view: "View",
      get: "Get",
      viewService: "View service",
      requestQuote: "Request a quote",
      notes: "Notes",
      servicesNotes: "For custom scopes, request a quote on the service page.",
      homeSub: "Quietly building useful ventures.<br/>Developing practical products and digital solutions to make everyone's life easier.",
      aboutTitle: "ABOUT US",
      aboutBody: "Ezion develops and manages consumer products, digital tools, and operational systems.<br/><br/>Small is not less. We prefer small teams, clear processes, and quiet products that have big impacts.",
      principles: "Principles",
      contact: "Contact",
      contactSub: "General enquiries",
      company: "Company",
      focus: "Focus",
      focusSub: "A concise snapshot (broad by design).",
      productsSectionTools: "Physical and Operational Tools",
      productsSectionApps: "Apps",
      productsSectionProductions: "Productions",

      p1Title: "Clarity",
      p1Body: "Simple positioning, clean execution, minimal maintenance.",
      p2Title: "Durability",
      p2Body: "Fewer moving parts. Systems that keep working.",
      p3Title: "Leverage",
      p3Body: "Repeatable processes and compounding improvements.",

      f1Title: "Brand & product incubation",
      f1Body: "From concept to early validation and launch readiness.",
      f2Title: "Digital tools and internal systems",
      f2Body: "Automation, operations tooling, and lightweight software.",
      f3Title: "Operations, logistics, and process design",
      f3Body: "Reducing friction and increasing reliability.",
      f4Title: "Research & development",
      f4Body: "Iterating and testing ideas for consumer applications.",

      legalNameLabel: "Legal name:",
      jurisdictionLabel: "Jurisdiction:",
      statusLabel: "Status:",
      copy: "Copy",
      copied: "Copied",
      copyFailed: "Copy failed",
      call: "Call",
      whatsapp: "WhatsApp",
      close: "Close",

      // Catalog translations
      catalog: {
        products: {
          workmateName: "Workmate — Professional Edition",
          workmateDesc: "Time tracking + invoicing workbook (Excel).",
          enzydrainName: "Enzydrain",
          enzydrainDesc: "Enzymatic drain maintenance tablets."
        },
        apps: {
          todayName: "TODAY — Minimalist’s Diary",
          todayDesc: "Minimalist daily journaling app.",
          yadaName: "YADA — Know Deeply",
          yadaDesc: "One biblical insight a day that goes a long way."
        },
        productions: {
          bookName: "Certainty in Uncertainty: Preparing for Jesus' Return in These Last Days",
          bookDesc: "An examination of biblical prophecy and present global realities, equipping the Church to understand the times and prepare faithfully for Christ’s return—sooner rather than later."
        },
        services: {
          appdevName: "iOS & Android app development",
          appdevDesc: "Flutter apps, store setup, deployment support.",
          automationName: "Process automation (Excel & Python)",
          automationDesc: "Excel VBA, Python scripts, workflow automation.",
          accountingName: "Accounting services",
          accountingDesc: "Setup, cleanup, reporting, and finance ops support."
        }
      }
    },

    // Simplified Chinese (zh-Hans) — SG/CN
    zhHans: {
      locale: "地区",
      about: "关于我们",
      products: "产品",
      services: "服务",
      home: "主页",
      view: "查看",
      get: "获取",
      viewService: "查看服务",
      requestQuote: "索取报价",
      notes: "备注",
      servicesNotes: "如需定制范围，请在服务页面提交报价请求。",
      homeSub: "低调打造实用项目。<br/>提供实用产品与数码解决方案，让生活更简单。",
      aboutTitle: "关于我们",
      aboutBody: "Ezion 研发并运营消费产品、数字工具与运营系统。<br/><br/>小团队不代表更少，而是更清晰。我们偏好简单、可靠、影响深远的产品。",
      principles: "原则",
      contact: "联系",
      contactSub: "一般咨询",
      company: "公司",
      focus: "方向",
      focusSub: "简要概览（刻意保持宽泛）。",
      productsSectionTools: "实体与运营工具",
      productsSectionApps: "应用",
      productsSectionProductions: "作品",

      p1Title: "清晰",
      p1Body: "定位简单，执行干净，维护最少。",
      p2Title: "耐用",
      p2Body: "更少的可变因素。系统长期稳定运行。",
      p3Title: "杠杆",
      p3Body: "可复用流程与持续复利式优化。",

      f1Title: "品牌与产品孵化",
      f1Body: "从概念到早期验证与发布准备。",
      f2Title: "数字工具与内部系统",
      f2Body: "自动化、运营工具与轻量软件。",
      f3Title: "运营、物流与流程设计",
      f3Body: "减少摩擦，提升可靠性。",
      f4Title: "研究与开发",
      f4Body: "迭代与测试面向用户的应用想法。",

      legalNameLabel: "法定名称：",
      jurisdictionLabel: "司法辖区：",
      statusLabel: "状态：",
      copy: "复制",
      copied: "已复制",
      copyFailed: "复制失败",
      call: "致电",
      whatsapp: "WhatsApp",
      close: "关闭",

      catalog: {
        products: {
          workmateName: "Workmate — 专业版",
          workmateDesc: "时间记录 + 开票工作簿（Excel）。",
          enzydrainName: "Enzydrain",
          enzydrainDesc: "酶解型下水道养护清洁片。"
        },
        apps: {
          todayName: "TODAY — 极简日记",
          todayDesc: "极简每日记录应用。",
          yadaName: "YADA — 深入认识",
          yadaDesc: "每日一则圣经洞见，简单却深远。"
        },
        productions: {
          bookName: "在不确定中得确定：在末后的日子预备迎接耶稣再来",
          bookDesc: "从圣经预言与当代现实出发，帮助教会分辨时代、忠心预备迎接基督再来——比你想象的更近。"
        },
        services: {
          appdevName: "iOS 与 Android 应用开发",
          appdevDesc: "Flutter 应用、商店上架配置与发布支持。",
          automationName: "流程自动化（Excel 与 Python）",
          automationDesc: "Excel VBA、Python 脚本与工作流自动化。",
          accountingName: "会计服务",
          accountingDesc: "搭建、清理、报表与财务运营支持。"
        }
      }
    },

    // Traditional Chinese (zh-Hant) — HK
    zhHant: {
      locale: "地區",
      about: "關於我們",
      products: "產品",
      services: "服務",
      home: "主頁",
      view: "查看",
      get: "獲取",
      viewService: "查看服務",
      requestQuote: "索取報價",
      notes: "備註",
      servicesNotes: "如需自訂範圍，請於服務頁面提出報價要求。",
      homeSub: "低調打造實用項目。<br/>提供實用產品與數碼解決方案，令生活更簡單。",
      aboutTitle: "關於我們",
      aboutBody: "Ezion 研發並營運消費產品、數碼工具與營運系統。<br/><br/>小團隊不代表更少，而是更清晰。我們偏好簡單、可靠、影響深遠的產品。",
      principles: "原則",
      contact: "聯絡",
      contactSub: "一般查詢",
      company: "公司",
      focus: "方向",
      focusSub: "簡要概覽（刻意保持寬泛）。",
      productsSectionTools: "實體與營運工具",
      productsSectionApps: "應用程式",
      productsSectionProductions: "作品",

      p1Title: "清晰",
      p1Body: "定位簡單，執行乾淨，維護最少。",
      p2Title: "耐用",
      p2Body: "更少的可變因素。系統長期穩定運作。",
      p3Title: "槓桿",
      p3Body: "可重複流程與持續複利式改進。",

      f1Title: "品牌與產品孵化",
      f1Body: "由概念到早期驗證與推出準備。",
      f2Title: "數碼工具與內部系統",
      f2Body: "自動化、營運工具與輕量軟件。",
      f3Title: "營運、物流與流程設計",
      f3Body: "減少摩擦，提升可靠性。",
      f4Title: "研究與開發",
      f4Body: "迭代與測試面向用戶的應用想法。",

      legalNameLabel: "法定名稱：",
      jurisdictionLabel: "司法管轄區：",
      statusLabel: "狀態：",
      copy: "複製",
      copied: "已複製",
      copyFailed: "複製失敗",
      call: "致電",
      whatsapp: "WhatsApp",
      close: "關閉",

      catalog: {
        products: {
          workmateName: "Workmate — 專業版",
          workmateDesc: "時間記錄 + 開票工作簿（Excel）。",
          enzydrainName: "Enzydrain",
          enzydrainDesc: "酵素型去水渠保養清潔片。"
        },
        apps: {
          todayName: "TODAY — 極簡日記",
          todayDesc: "極簡每日記錄應用程式。",
          yadaName: "YADA — 深入認識",
          yadaDesc: "每日一則聖經洞見，簡單卻深遠。"
        },
        productions: {
          bookName: "在不確定中得確定：在末後的日子預備迎接耶穌再來",
          bookDesc: "由聖經預言與當代現實出發，幫助教會分辨時代、忠心預備迎接基督再來——比你想像的更近。"
        },
        services: {
          appdevName: "iOS 與 Android 應用開發",
          appdevDesc: "Flutter 應用、商店上架設定與發佈支援。",
          automationName: "流程自動化（Excel 與 Python）",
          automationDesc: "Excel VBA、Python 腳本與工作流程自動化。",
          accountingName: "會計服務",
          accountingDesc: "建立、整理、報表與財務營運支援。"
        }
      }
    }
  };

  function getTextPack(ctx){
    if (ctx && ctx.key === "hk-zh") return I18N.zhHant;
    if (ctx && ctx.lang === "zh") return I18N.zhHans; // sg-zh + cn-zh
    return I18N.en;
  }

  function applyText(ctx){
    const t = getTextPack(ctx);

    document.getElementById("openInfo").textContent = t.about;
    document.getElementById("btnProducts").textContent = t.products;
    document.getElementById("btnServices").textContent = t.services;

    document.getElementById("btnHomeFromProducts").textContent = t.home;
    document.getElementById("btnHomeFromServices").textContent = t.home;

    document.getElementById("productsTitle").textContent = t.products;
    document.getElementById("servicesTitle").textContent = t.services;

    document.getElementById("servicesNotesTitle").textContent = t.notes;
    document.getElementById("servicesNotesText").textContent = t.servicesNotes;

    document.getElementById("homeSub").innerHTML = t.homeSub;

    document.getElementById("aboutTitle").textContent = t.aboutTitle;
    document.getElementById("aboutBody").innerHTML = t.aboutBody;
    document.getElementById("aboutPrinciplesTitle").textContent = t.principles;

    document.getElementById("contactTitle").textContent = t.contact;
    document.getElementById("contactSub").textContent = t.contactSub;
    document.getElementById("companyTitle").textContent = t.company;

    document.getElementById("focusTitle").textContent = t.focus;
    document.getElementById("focusSub").textContent = t.focusSub;

    document.getElementById("productsSectionTools").textContent = t.productsSectionTools;
    document.getElementById("productsSectionApps").textContent = t.productsSectionApps;
    document.getElementById("productsSectionProductions").textContent = t.productsSectionProductions;

    document.getElementById("p1Title").textContent = t.p1Title;
    document.getElementById("p1Body").textContent = t.p1Body;
    document.getElementById("p2Title").textContent = t.p2Title;
    document.getElementById("p2Body").textContent = t.p2Body;
    document.getElementById("p3Title").textContent = t.p3Title;
    document.getElementById("p3Body").textContent = t.p3Body;

    document.getElementById("f1Title").textContent = t.f1Title;
    document.getElementById("f1Body").textContent = t.f1Body;
    document.getElementById("f2Title").textContent = t.f2Title;
    document.getElementById("f2Body").textContent = t.f2Body;
    document.getElementById("f3Title").textContent = t.f3Title;
    document.getElementById("f3Body").textContent = t.f3Body;
    document.getElementById("f4Title").textContent = t.f4Title;
    document.getElementById("f4Body").textContent = t.f4Body;

    document.getElementById("companyLegalLabel").textContent = t.legalNameLabel;
    document.getElementById("companyJurisdictionLabel").textContent = t.jurisdictionLabel;
    document.getElementById("companyStatusLabel").textContent = t.statusLabel;

    const copyBtn = document.getElementById("copyBtn");
    if (copyBtn) copyBtn.textContent = t.copy;

    document.querySelectorAll("[data-phone]").forEach(a => { a.textContent = t.call; });
    document.querySelectorAll("[data-whatsapp]").forEach(a => { a.textContent = t.whatsapp; });

    document.getElementById("closeInfo").textContent = t.close;
  }

  // -----------------------------
  // About panel open/close
  // -----------------------------
  const panel = document.getElementById("panel");
  const openInfo = document.getElementById("openInfo");
  const closeInfo = document.getElementById("closeInfo");
  const backdrop = document.getElementById("backdrop");

  function openPanel(){
    panel.classList.add("open");
    panel.setAttribute("aria-hidden", "false");
    document.body.style.overflow = "hidden";
  }
  function closePanel(){
    panel.classList.remove("open");
    panel.setAttribute("aria-hidden", "true");
    document.body.style.overflow = "";
  }

  openInfo.addEventListener("click", openPanel);
  closeInfo.addEventListener("click", closePanel);
  backdrop.addEventListener("click", closePanel);
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") closePanel();
  });

  // -----------------------------
  // Copy + toast (localized)
  // -----------------------------
  const toast = document.getElementById("toast");
  let toastTimer;
  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add("show");
    clearTimeout(toastTimer);
    toastTimer = setTimeout(() => toast.classList.remove("show"), 1200);
  }
  document.addEventListener("click", async (e) => {
    const btn = e.target.closest("[data-copy]");
    if (!btn) return;
    const text = btn.getAttribute("data-copy");
    const t = getTextPack(EzionLocale.getContext());
    try { await navigator.clipboard.writeText(text); showToast(t.copied); }
    catch { showToast(t.copyFailed); }
  });

  document.getElementById("year").textContent = new Date().getFullYear();

  // -----------------------------
  // Router: #products / #services / home
  // -----------------------------
  const viewHome = document.getElementById("view-home");
  const viewProducts = document.getElementById("view-products");
  const viewServices = document.getElementById("view-services");

  function setView(name){
    const isProducts = name === "products";
    const isServices = name === "services";

    viewHome.classList.toggle("active", !(isProducts || isServices));
    viewProducts.classList.toggle("active", isProducts);
    viewServices.classList.toggle("active", isServices);

    if (panel.classList.contains("open")) closePanel();
    document.body.style.overflow = "";
  }

  function onRoute(){
    const hash = (location.hash || "").replace("#", "").trim().toLowerCase();
    if (hash === "products") setView("products");
    else if (hash === "services") setView("services");
    else setView("home");
  }
  window.addEventListener("hashchange", onRoute);

  function escapeHtml(s){
    return String(s)
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;")
      .replaceAll("'", "&#039;");
  }

  // -----------------------------
  // Data (base in GBP; display localized)
  // -----------------------------
  const PRODUCTS = [
    { category:"products", key:"workmate", price:{ type:"fixed", amount:9.99, currency:"GBP" }, sku:"WM-PRO-001", page:"products/workmate-pro.html" },
    { category:"products", key:"enzydrain", price:{ type:"fixed", amount:8.50, currency:"GBP" }, sku:"EZD-TRIAL-001", page:"products/workmate-pro.html" },

    { category:"apps", key:"today", price:{ type:"from", amount:0.00, currency:"GBP" }, sku:"MD-LIFE-001", page:"products/today.html", priceDisplayOverride:"free_to_from" },
    { category:"apps", key:"yada", price:{ type:"from", amount:0.99, currency:"GBP" }, sku:"YADA-APP-001", page:"products/yada.html", priceDisplayOverride:"free_to_from" },

    { category:"productions", key:"book", price:{ type:"fixed", amount:14.99, currency:"GBP" }, sku:"END-BOOK-001", page:"products/yada.html" }
  ];

  const SERVICES = [
    { key:"appdev", price:{ type:"from", amount:499, currency:"GBP" }, sku:"SVC-APP-001", page:"services/appdev.html" },
    { key:"automation", price:{ type:"from", amount:199, currency:"GBP" }, sku:"SVC-AUTO-001", page:"services/automation.html" },
    { key:"accounting", price:{ type:"from", amount:149, currency:"GBP" }, sku:"SVC-ACC-001", page:"services/accounting.html" }
  ];

  const productsGridProducts = document.getElementById("productsGridProducts");
  const productsGridApps = document.getElementById("productsGridApps");
  const productsGridProductions = document.getElementById("productsGridProductions");
  const servicesGrid = document.getElementById("servicesGrid");

  function productCard(p, ctx, t){
    const c = t.catalog;
    const name =
      p.category === "products" && p.key === "workmate" ? c.products.workmateName :
      p.category === "products" && p.key === "enzydrain" ? c.products.enzydrainName :
      p.category === "apps" && p.key === "today" ? c.apps.todayName :
      p.category === "apps" && p.key === "yada" ? c.apps.yadaName :
      p.category === "productions" && p.key === "book" ? c.productions.bookName :
      "";

    const desc =
      p.category === "products" && p.key === "workmate" ? c.products.workmateDesc :
      p.category === "products" && p.key === "enzydrain" ? c.products.enzydrainDesc :
      p.category === "apps" && p.key === "today" ? c.apps.todayDesc :
      p.category === "apps" && p.key === "yada" ? c.apps.yadaDesc :
      p.category === "productions" && p.key === "book" ? c.productions.bookDesc :
      "";

    let priceText = EzionLocale.formatPrice(p.price, ctx);

    if (p.priceDisplayOverride === "free_to_from") {
      const isZh = (ctx.key === "hk-zh" || ctx.lang === "zh");
      const freeText = isZh ? (ctx.key === "hk-zh" ? "免費" : "免费") : "FREE";
      const fromLabel = isZh ? "起" : "From";
      const fromVal = EzionLocale.money(
        EzionLocale.convertAmount(0.99, "GBP", ctx.currency),
        ctx.currency,
        ctx.numberLocale
      );
      priceText = `${freeText} – ${fromVal} ${fromLabel}`;
    }

    return `
      <div class="product">
        <div class="name">${escapeHtml(name)}</div>
        <div class="desc">${escapeHtml(desc)}</div>

        <div class="meta">
          <div>${escapeHtml(priceText)}</div>
          <div class="sku">${escapeHtml(p.sku)}</div>
        </div>

        <div class="btnRow">
          <a class="btn" href="${p.page}">${escapeHtml(t.view)}</a>
          <a class="btn secondary" href="${p.page}#buy">${escapeHtml(t.get)}</a>
        </div>
      </div>
    `;
  }

  function serviceCard(s, ctx, t){
    const c = t.catalog.services;
    const name =
      s.key === "appdev" ? c.appdevName :
      s.key === "automation" ? c.automationName :
      s.key === "accounting" ? c.accountingName : "";

    const desc =
      s.key === "appdev" ? c.appdevDesc :
      s.key === "automation" ? c.automationDesc :
      s.key === "accounting" ? c.accountingDesc : "";

    const priceText = EzionLocale.formatPrice(s.price, ctx);

    return `
      <div class="product">
        <div class="name">${escapeHtml(name)}</div>
        <div class="desc">${escapeHtml(desc)}</div>

        <div class="meta">
          <div>${escapeHtml(priceText)}</div>
          <div class="sku">${escapeHtml(s.sku)}</div>
        </div>

        <div class="btnRow">
          <a class="btn" href="${s.page}">${escapeHtml(t.viewService)}</a>
          <a class="btn secondary" href="${s.page}#quote">${escapeHtml(t.requestQuote)}</a>
        </div>
      </div>
    `;
  }

  function renderAll(ctx){
    const localeInfo = ctx || EzionLocale.getContext();
    const t = getTextPack(localeInfo);

    applyText(localeInfo);

    document.title =
      (localeInfo.country === "SG") ? "Ezion SG" :
      (localeInfo.country === "HK") ? "Ezion HK" :
      (localeInfo.country === "US") ? "Ezion US" :
      "Ezion UK";

    const byCat = (cat) => PRODUCTS
      .filter(p => p.category === cat)
      .map(p => productCard(p, localeInfo, t))
      .join("");

    productsGridProducts.innerHTML = byCat("products");
    productsGridApps.innerHTML = byCat("apps");
    productsGridProductions.innerHTML = byCat("productions");

    servicesGrid.innerHTML = SERVICES.map(s => serviceCard(s, localeInfo, t)).join("");

    EzionLocale.applyContactTargets();
    EzionLocale.applyCompanyInfo();
  }

  EzionLocale.init({
    onReady(ctx){
      renderAll(ctx);
      onRoute();
    },
    onChange(ctx){
      renderAll(ctx);
    }
  });
</script>
